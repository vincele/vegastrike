#!/usr/bin/python
import cgitb; cgitb.enable()
import cgi
import settings

# Make browser treat this as an XML file:
print "Content-Type: text/xml"
print ""

f=open (settings.data_path+"/units/vegastrike.config")
s=f.read()
f.close()
form = cgi.FieldStorage()
#check_form(form)
username = form["username"].value
password = form["password"].value
wherecallsign=s.find('"callsign"')
wherepassword=s.find('"password"')
wherename=s.find('"realname"')
whereforcenet=s.find('"force_client_connect"')
wheredefmis  =s.find('"default_mission"')
def myreplace(s,where,replacer):
	if where==-1:
		return s
	keyfind='value="'
	where2=s[where:].find(keyfind)
	if where2==-1:
		return s
	where2+=len(keyfind)+where
	where3=s[where2:].find('"')
	if where3==-1:
		return s
	where3+=where2
	return s[:where2]+replacer+s[where3:]
def comment(s, str):
	pos=s.find(str)
	if pos==0 or pos==-1:
		return s
	prevendcomment = s.rfind('-->', 0, pos)
	prevbegincomment = s.rfind('<!--', 0, pos)
	if prevbegincomment!=-1:
		if prevendcomment==-1 or prevendcomment<prevbegincomment:
			return s
	return s[:pos]+'<!--'+str+'-->'+s[pos+len(str)+1:]
s = comment(s, '<bind key="y" modifier="none" command="SwitchCombatMode" />')
#s = comment(s, '<bind key="a" modifier="none" command="ToggleWarpDrive" />');
s=myreplace (s,wherecallsign,username);
s=myreplace (s,wherepassword,password);
s=myreplace (s,wherename,username);
s=myreplace (s,whereforcenet,"true")
s=myreplace (s,wheredefmis,"net.mission")
print s
